# Reviewing font families for Google Fonts


This guide is for contributers who review or dispatch font families from [google/fonts](https://github.com/google/fonts/pulls) to [Google Fonts](https://fonts.google.com).


## TL;DR: An acceptable pull request

**Fontbakery**
- No FAILS (some false positives may occur, these should be discussed)

**Font Diffenator**
- There should be no missing encoded glyphs
- Modified glyphs should bear some resemblence to the previous release
- There shouldn't be too many missing kerning pairs, marks or mkmks

**Diffbrowsers**
- There should be no pixel jumps in the waterfall view (some are allowed if the family isn't too popular)
- Horizontal line length should be similiar to previous release


## Getting the test results for new/updated families

Our qa reports are generated by [gftools qa](https://github.com/googlefonts/gftools/blob/master/bin/gftools-qa.py). It's an orchestration script which controls our three qa tools [Fontbakery](https://github.com/googlefonts/fontbakery), [Font Diffenator](https://github.com/googlefonts/fontdiffenator) and [Diffbrowsers](https://github.com/googlefonts/diffbrowsers). This script allows us to run a full qa for a family. It will run automatically when a user submits a pull request to google/fonts. It can also be run locally from a user's machine.

It has an option to compare the family against the same family  served on [fonts.google.com](https://fonts.google.com). This option must be enabled if the updated family is for Google Fonts.

**A pull request on google/fonts**

Wait for travis to finish running the qa script. The results will then be posted back by the gf bot as a [comment](https://github.com/google/fonts/pull/1938#issuecomment-483302340). Download the attached qa.zip file.

*Note: Pull requests must not be made from forked repositories. Our setup relies on private environment variables which Travis has disabled in forked repositories for security reasons. If you would like to submit a pull request, please push a branch to google/fonts then open a pull request from that branch. More information can be found [here](https://docs.travis-ci.com/user/environment-variables/#defining-encrypted-variables-in-travisyml).*

**Checking Locally**

Once you have installed [gftools](https://github.com/googlefonts/gftools), You can then qa families locally against the fonts hosted on Google Fonts using the following command:

`gftoola qa [fonts.ttf] -a -o qa`

When the script has finished, you should have a directory for each tool which contains the test results. For Diffenator results, it's best to view the html reports in a browser, instead of viewing the images and txt report individually.

*For gftools installation instructions, please follow the installation instructions in the [README](https://github.com/googlefonts/gftools)*


## Understanding the test results

Reviewing pull requests for font families is not a black and white process. Occasionally, we may need to push fonts which will cause regressions. If this happens, they'll need approving before they're pushed into production. Below we aim to outline for each tool what is and isn't acceptable.



### Fontbakery

Fontbakery ensures that font files conform to the [OpenType](https://docs.microsoft.com/en-us/typography/opentype/spec/) specification. It features check profiles which are written by ourselves and 3rd party vendors such as Adobe.

We expect there shouldn't be any FAILS reported when checking a font family using the googlefonts check profile. Some FAILS may occur due to faulty tests or tests which haven't been updated to match a specification change. If a user notices that a check is faulty, it should be reported in the [Fontbakery issue tracker](https://github.com/googlefonts/fontbakery).

*Note: The following command can be used to run fontbakery with the googlefonts profile, `fontbakery check-googlefonts [fonts.ttf]`*

### Font Diffenator

Font Diffenator is used to spot regressions between font releases. It can spot regressions involving glyphs, kerning, marks, mkmks, names and attributes.

We need this tool because Google Fonts doesn't have a versioned api. When an updated family is pushed into production, all users receive the update. To ensure we don't upset existing users, we cannot release updates which have radically altered the existing data, unless approved. Below we outline changes which shouldn't be allowed for each category.

#### Glyphs

**New glyphs**

They should appear like the character it is meant to represent, e.g Sometimes components are in the [wrong order](https://github.com/google/fonts/issues/588#issue-202368525) or the designer has drawn the wrong character for the [glyph's unicode block](https://github.com/google/fonts/issues/1939).

**Missing glyphs**

Ideally there shouldn't be any missing glyphs. However, exceptions can be made if a designer has deprecated an incorrect OT feature. We recommend that no encoded glyphs are missing.

*Note: The Google Fonts web api strips out most OpenType features but the downloadable fonts do contain them.*

**Modified glyphs**

These glyphs should bear some resemblance to the previous release. E.g changing a double story "a" for a single story "a" isn't acceptable, unless it has been requested.

#### Attributes

Attributes are tested thoroughly by Fontbakery. It will raise FAILS if anything looks suspicious. However, it's still useful to inspect what has changed between the releases.

#### Names

Names are also checked by Fontbakery. A common occurrence for missing/new names is when a user changes font build system. Glyphsapp will include Win and Mac name records, whilst fontmake will only include Win name records. There's nothing wrong with fonts that don't include mac name records.

#### Kerns

We're fairly relaxed when it comes to new, missing or modified kerns. If thousands of kerns are missing and there are no new kerns, it's a good indication that the kerning hasn't exported. Font Diffenator's logger will raise this issue during runtime.

*Note: Class kerning is flattened so if a font contains a thousand class kerns, the actual number of kerns may be in the hundreds of thousands!*

**New kerns**

New kerns can decrease the line length. However, this should have been reviewed and signed off at the design phase of the project.

*Note: Diffbrowsers gives a better indication on whether the line length has changed significantly.*

**Missing kerns**

In general there shouldn't be too many missing kerns (under a thousand). However, fontmake and glyphsapp will often generate kerns differently which can be the primary cause 

**Modified kerns**
Kerns often get modified when designers add a new writing system to an existing typeface. As long as the changes are not in the thousands, it's generally fine.

#### Marks and Mkmks

We have noticed that Fontmake and Glyphsapp will generate marks differently. Fontmake will not produce as many Marks and MkMks. We have released family updates where we have changed the build system and not a single complaint was raised.

*Note: We are working on a filter which will show only marks and mkmks which exist in the whole of Wikipedia (~23tb). This should help reviewers not focus on differences produced between font build systems. For the time being, we suggest that as long as there are just missing marks, it's generally fine.*


### Diffbrowsers

Diffbrowsers allows us to test how font families render on different browsers. Tests are run on the following browsers:

- OS X Safari
- Win 10 Chrome
- Wine 10 Firefox

These three browsers will test the three major rasterisers Directwrite, FreeType and Quartz.

Unfortunately hinting regressions are frequent. Most families on Google Fonts are hinted using [ttfautohint](https://freetype.org/ttfautohint/). We've noticed that each version produces different results. This makes it difficult to reproduce a font's hinting. Due to this, hinting needs to be examined and signed off by a Google Fonts team member. Often, we'll release a font if the hinting has changed if it's an improvement.

**Waterfall**

Ideally, there shouldn't be any cap height or x-height jumps in the waterfall view for any browsers. If the family is incredibly popular (Roboto, Open Sans) we really don't want to cause any regressions.

**glyphs all**

Make sure that accents are not colliding with their base glyphs.

*Note:*

- *This tool relies  on [Browserstack](https://www.browserstack.com/). You will need a Browserstack account in order to use it.*
- *OS X doesn't use a font's hints. The rasteriser does everything.*


## Examples of pull requests which were approved.


If you're questioning whether your pull request will be approved. Study the following approved prs:

- [Poppins v4.003](https://github.com/google/fonts/pull/1924)
- [B612 v1.008](https://github.com/google/fonts/pull/1877)

